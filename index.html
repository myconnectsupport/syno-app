<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Synoptique Technicien</title>
    <link rel="icon" href="assets/myco.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="style.css" />

<div id="auth-overlay" class="fixed inset-0 flex items-center justify-center overflow-hidden z-[9999]">

  <!-- GRADIENT FOND -->
  <div class="absolute inset-0 animated-gradient"></div>

  <!-- LOGO AU-DESSUS DU GRADIENT -->
  <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
    <img src="assets/myco2.png"
         class="w-[1050px] max-w-[80%] opacity-10 select-none" />
  </div>

  <!-- CONTENU -->
  <div class="relative z-20 text-center text-white px-6">

    <h1 class="text-5xl md:text-6xl font-light tracking-[0.4em] mb-[280px] animate-title">
      MYSYNO
    </h1>

    <div class="flex flex-col gap-6 w-72 mx-auto">

      <input
        type="password"
        id="pass-field"
        maxlength="4"
        placeholder="Code"
        autofocus
        onkeydown="if(event.key === 'Enter') checkPass()"
        class="w-full py-3 rounded-2xl text-center text-white
                bg-white/10 backdrop-blur-md
                outline-none transition duration-300
                focus:bg-white/20 focus:shadow-[0_0_15px_rgba(255,255,255,0.3)]"
      />

      <button onclick="checkPass()"
        class="bg-white text-black font-semibold py-3 rounded-2xl 
               transition duration-300 hover:scale-105 active:scale-95">
        VALIDER
      </button>

      <div id="authLoader"
        class="hidden w-10 h-10 mx-auto border-4 border-white 
               border-t-transparent rounded-full animate-spin">
      </div>

    </div>
  </div>
</div>



    <input
      type="file"
      id="fileLoader"
      style="display: none"
      accept=".json"
      onchange="loadProject(this)"
    />
    <input
      type="file"
      id="photoInput"
      style="display: none"
      accept="image/*"
      onchange="processPhoto(this)"
    />

    <div class="header">
      <div class="dark-mode-toggle">
        <label class="switch">
          <input
            type="checkbox"
            id="darkModeSwitch"
            onchange="toggleDarkMode()"
          />
          <span class="slider"></span>
        </label>
        <span class="dark-mode-label">ğŸŒ™</span>
      </div>

      <div class="save-status saved" id="saveStatus">
        <span class="status-dot">ğŸŸ¢</span>
        <span class="status-text">SauvegardÃ©</span>
      </div>

      <input
        type="text"
        id="siteName"
        class="site-name-input"
        placeholder="?-- Nom du site --?"
        oninput="checkInput()"
      />

      <div class="header-actions">
        <button
          class="header-btn-labeled save-btn"
          onclick="saveProject()"
          title="Sauvegarder"
        >
          <span class="btn-icon">ğŸ’¾</span>
          <span class="btn-label">Sauver</span>
        </button>

        <button 
          class="header-btn-labeled bouton-poubelle" 
          style="margin-left: auto;" 
          onclick="if(confirm('Tout effacer...')) clearBrowserSave()" 
         title="Nouveau Projet"
          >
          <span class="btn-icon">ğŸ—‘ï¸</span>
          <span class="btn-label">Nouveau</span>
        </button>

        <button
          class="header-btn-labeled open-btn"
          onclick="triggerLoad()"
          title="Ouvrir"
        >
          <span class="btn-icon">ğŸ“‚</span>
          <span class="btn-label">Ouvrir</span>
        </button>

        <button
          class="header-btn-labeled add-btn"
          onclick="openAddModal()"
          title="Ajouter Ã©quipement"
        >
          <span class="btn-icon">+</span>
          <span class="btn-label">Ajouter</span>
        </button>

        <button
          class="header-btn-labeled del-zone-btn"
          id="delZoneBtn"
          onclick="toggleSelectionMode()"
          title="Supprimer une zone"
        >
          <span class="btn-icon">â›</span>
          <span class="btn-label">Zone Suppr.</span>
        </button>

        <button
          class="header-btn-labeled multi-select-btn"
          id="multiSelectBtn"
          onclick="toggleMultiSelectMode()"
          title="SÃ©lectionner plusieurs Ã©quipements"
        >
          <span class="btn-icon">â¬š</span>
          <span class="btn-label">Zone SÃ©lect.</span>
        </button>

        <button
          class="header-btn-labeled pen-btn"
          id="penBtn"
          onclick="togglePenMode()"
          title="Reconnecter des Ã©quipements"
        >
          <span class="btn-icon">âœï¸</span>
          <span class="btn-label">Liens</span>
        </button>

        <button class="header-btn-labeled" id="btnUndo" onclick="undo()" title="Annuler (Ctrl+Z)" disabled style="opacity:0.5;">
            <span class="btn-icon">â†©ï¸</span>
            <span class="btn-label">Annuler</span>
        </button>

        <button class="header-btn-labeled" id="btnRedo" onclick="redo()" title="RÃ©tablir (Ctrl+Y)" disabled style="opacity:0.5;">
            <span class="btn-icon">â†ªï¸</span>
            <span class="btn-label">RÃ©tablir</span>
        </button>

        <button class="header-btn-labeled excel-btn" onclick="exportToExcel()" title="Exporter inventaire (.xlsx)">
            <span class="btn-icon">ğŸ“Š</span>
            <span class="btn-label">Export Excel</span>
        </button>

        <button
          class="header-btn-labeled export-btn disabled"
          id="btnDownload"
          onclick="downloadPDF()"
          title="Exporter en PDF"
        >
          <span class="btn-icon">â¬‡</span>
          <span class="btn-label">Export PDF</span>
        </button>
      </div>    
    </div>

    <div class="floating-ui trash-zone">
      <button class="fab-btn" id="photo-btn" onclick="triggerPhotoUpload()">
        ğŸ“·
      </button>
    </div>

    <div class="floating-ui zoom-zone">
      <button class="fab-btn zoom-btn" onclick="updateZoom(0.1)">+</button>
      <button
        class="fab-btn zoom-btn"
        style="font-size: 20px"
        onclick="resetZoom()"
      >
        âŒ‚
      </button>
      <button class="fab-btn zoom-btn" onclick="updateZoom(-0.1)">-</button>
    </div>

    <div class="zoom-indicator" id="zoomIndicator">100%</div>

    <div class="position-indicator" id="positionIndicator">X: 0 | Y: 0</div>

    <div id="workspace-wrapper">
      <div id="workspace-container" onmousedown="handleWorkspaceMouseDown(event)">
        <svg id="connections-layer"></svg>
        <div id="selectionBox"></div>
      </div>
    </div>

    <div class="modal-overlay" id="addModal">
      <div class="modal-content">
        <h3 id="modalTitle">Nouvel Ã‰quipement</h3>
        <div class="form-group">
          <label>Type d'appareil</label>
          <select id="newType" onchange="updateFormFields(this.value)">
            <option value="routeur">Routeur Mikrotik ğŸ“¶</option>
            <option value="switch">Switch ğŸ”Œ</option>
            <option value="nvr">NVR ğŸ“¼</option>
            <option value="bullet">CamÃ©ra Bullet ğŸ“¹</option>
            <option value="dome">CamÃ©ra DÃ´me ğŸ¥</option>
            <option value="box">Box / Internet ğŸŒ</option>
            <option value="ecran">Ã‰cran (PC) ğŸ–¥ï¸</option>
            <option value="radio">Ponts Radios ğŸ“¡</option>
            <option value="ampli">Ampli Audio ğŸ“¢</option>
            <option value="pupitre">Pupitre Micro ğŸ¤</option>
          </select>
        </div>

        <div class="form-group" id="radioModeGroup" style="display: none">
          <label>Mode</label>
          <select id="radioMode">
            <option value="couple">Couple PE/PR (automatique)</option>
            <option value="pe">Point Ã‰metteur (PE) seul</option>
            <option value="pr">Point RÃ©cepteur (PR) seul</option>
          </select>
        </div>

        <div
          class="form-group"
          id="radioCoupleQuantityGroup"
          style="display: none"
        >
          <label>Nombre de couples Ã  crÃ©er</label>
          <select id="radioCoupleQuantity">
            <option value="1">1 couple (Standard)</option>
            <option value="2">2 couples</option>
            <option value="3">3 couples</option>
            <option value="4">4 couples</option>
            <option value="5">5 couples</option>
            <option value="10">10 couples</option>
          </select>
        </div>

        <div class="form-group" id="quantityGroup" style="display: none">
          <label>QuantitÃ© Ã  ajouter</label>
          <select id="newQuantity">
            <option value="1">1 (Standard)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
          </select>
        </div>

        <div class="form-group" id="hpGroup" style="display: none">
          <label>ğŸ”Š Haut-Parleurs (HP) connectÃ©s</label>

          <div style="margin-bottom: 10px">
            <label style="font-size: 0.85rem; color: #666"
              >Nombre de HP (1 Ã  4)</label
            >
            <select
              id="hpCount"
              onchange="updateHPFields()"
              style="
                width: 100%;
                padding: 10px;
                border: 2px solid #007aff;
                border-radius: 8px;
                font-size: 1rem;
                background: #eff6ff;
                font-weight: bold;
              "
            >
              <option value="1">1 HP</option>
              <option value="2">2 HP</option>
              <option value="3">3 HP</option>
              <option value="4">4 HP</option>
            </select>
          </div>

          <div
            style="
              background: #fff7ed;
              padding: 10px;
              border-radius: 6px;
              margin-bottom: 10px;
              border-left: 3px solid #f59e0b;
            "
          >
            <small style="color: #92400e; font-size: 0.85rem">
              â„¹ï¸ Les HP hÃ©ritent de la localisation de l'ampli (connexion
              analogique)
            </small>
          </div>

          <div id="hpNamesContainer"></div>
        </div>

        <div class="form-group">
          <label>Nom / RÃ©f</label>
          <div id="nameFieldContainer">
            <input
              type="text"
              id="newDeviceName"
              placeholder="Ex: Switch-RDC"
            />
          </div>
        </div>

        <div class="form-group">
          <label>Adresse IP</label>
          <div id="ipFieldContainer">
            <input type="text" id="newIP" placeholder="Ex: 192.168.1.10" />
          </div>
        </div>

        <div class="form-group" id="locationPRGroup" style="display: none">
          <label>Localisation PR</label>
          <input
            type="text"
            id="newLocationPR"
            placeholder="Ex: Toit bÃ¢timent B"
          />
        </div>

        <div class="form-group" id="locationGroup">
          <label id="locationLabel">Localisation</label>
          <input
            type="text"
            id="newLocation"
            placeholder="Ex: Baie de brassage"
          />
        </div>

        <div class="form-group">
          <label>ConnectÃ© Ã </label
          ><select id="newParent">
            <option value="">-- Racine --</option>
          </select>
        </div>
        <button
          id="modalActionBtn"
          class="btn-full btn-primary"
          onclick="addEquipment()"
        >
          Ajouter
        </button>
        <button class="btn-full btn-cancel" onclick="closeAddModal()">
          Annuler
        </button>
      </div>
    </div>

    <div id="photo-modal-overlay">
      <img id="full-photo" src="" alt="Photo Ã©quipement" />
      <div class="photo-controls">
        <button
          class="icon-btn"
          onclick="closePhotoViewer()"
          style="background: rgba(255, 255, 255, 0.3)"
        >
          âœ•
        </button>
        <button
          class="icon-btn"
          onclick="deleteCurrentPhoto()"
          style="background: rgba(255, 59, 48, 0.6)"
        >
          ğŸ—‘ï¸
        </button>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <div
      id="connectionMenu"
      style="display: none; position: absolute; z-index: 500"
    >
      <div
        style="
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          padding: 8px;
          min-width: 180px;
        "
      >
        <div
          class="connection-option"
          onclick="setConnectionStyle('ethernet')"
          style="
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
          "
        >
          <span style="font-size: 20px">ğŸ”µ</span>
          <span style="font-size: 0.9rem; font-weight: 500"
            >RÃ©seau Ethernet</span
          >
        </div>

        <div
          class="connection-option"
          onclick="setConnectionStyle('radio')"
          style="
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
          "
        >
          <span style="font-size: 20px">ğŸ“¡</span>
          <span style="font-size: 0.9rem; font-weight: 500">Liaison Radio</span>
        </div>

        <div
          class="connection-option"
          onclick="setConnectionStyle('fiber')"
          style="
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
          "
        >
          <span style="font-size: 20px">ğŸ’¡</span>
          <span style="font-size: 0.9rem; font-weight: 500">Fibre Optique</span>
        </div>

        <hr style="margin: 8px 0; border: none; border-top: 1px solid #eee" />

        <div
          class="connection-option"
          onclick="reformatConnection()"
          style="
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #34C759;
          "
        >
          <span style="font-size: 20px">âœ¨</span>
          <span style="font-size: 0.9rem; font-weight: 600">Mettre en forme</span>
        </div>

        <div
          class="connection-option"
          onclick="deleteConnection()"
          style="
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ff3b30;
          "
        >
          <span style="font-size: 20px">âœ‚ï¸</span>
          <span style="font-size: 0.9rem; font-weight: 600">Supprimer</span>
        </div>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
